# ๐๏ธ Architektura Techniczna

## Stack Technologicznyc

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      FRONTEND                           โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ     โ
โ  โ   HTML5     โ  โ   CSS3      โ  โ JavaScript  โ     โ
โ  โ  (index)    โ  โ  (styles)   โ  โ   (app)     โ     โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ     โ
โ                         โ REST API                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                      BACKEND                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                   FastAPI                        โ   โ
โ  โ  โโโโโโโโโโโโโ  โโโโโโโโโโโโโ  โโโโโโโโโโโโโ   โ   โ
โ  โ  โ   Auth    โ  โ   CRUD    โ  โ  Reports  โ   โ   โ
โ  โ  โ  (JWT)    โ  โ Endpoints โ  โ  Engine   โ   โ   โ
โ  โ  โโโโโโโโโโโโโ  โโโโโโโโโโโโโ  โโโโโโโโโโโโโ   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         โ ORM                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                 SQLAlchemy                       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                     DATABASE                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ          SQLite (dev) / PostgreSQL (prod)        โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Baza Danych - ERD

```
โโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโ
โ     users       โ       โ     events      โ
โโโโโโโโโโโโโโโโโโโค       โโโโโโโโโโโโโโโโโโโค
โ id (PK)         โโโโโโโ<โ created_by (FK) โ
โ email           โ       โ id (PK)         โ
โ full_name       โ       โ name            โ
โ password_hash   โ       โ date            โ
โ role            โ       โ capacity        โ
โ is_active       โ       โ entry_fee       โ
โ created_at      โ       โ description     โ
โโโโโโโโโโโโโโโโโโโ       โ created_at      โ
         โ                โโโโโโโโโโโโโโโโโโโ
         โ                        โ
         โ                        โ
         โผ                        โผ
โโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโ
โ     costs       โ       โ    revenue      โ
โโโโโโโโโโโโโโโโโโโค       โโโโโโโโโโโโโโโโโโโค
โ id (PK)         โ       โ id (PK)         โ
โ event_id (FK)   โ       โ event_id (FK)   โ
โ category        โ       โ source          โ
โ amount          โ       โ amount          โ
โ description     โ       โ description     โ
โ created_by (FK) โ       โ recorded_by(FK) โ
โ created_at      โ       โ created_at      โ
โโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโ
```

## Przepลyw Autentykacji

```
โโโโโโโโโโโโ      โโโโโโโโโโโโ      โโโโโโโโโโโโ
โ  Client  โ      โ   API    โ      โ    DB    โ
โโโโโโฌโโโโโโ      โโโโโโฌโโโโโโ      โโโโโโฌโโโโโโ
     โ                 โ                 โ
     โ  POST /login    โ                 โ
     โโโโโโโโโโโโโโโโโ>โ                 โ
     โ                 โ  verify user    โ
     โ                 โโโโโโโโโโโโโโโโโ>โ
     โ                 โ<โโโโโโโโโโโโโโโโโ
     โ                 โ                 โ
     โ  JWT tokens     โ                 โ
     โ<โโโโโโโโโโโโโโโโโ                 โ
     โ                 โ                 โ
     โ  GET /events    โ                 โ
     โ  + Bearer token โ                 โ
     โโโโโโโโโโโโโโโโโ>โ                 โ
     โ                 โ  verify JWT     โ
     โ                 โ  check role     โ
     โ                 โโโโโโโโโโโโโโโโโ>โ
     โ                 โ<โโโโโโโโโโโโโโโโโ
     โ  events data    โ                 โ
     โ<โโโโโโโโโโโโโโโโโ                 โ
```

## System Rรณl (RBAC)

| Rola | Events | Costs | Revenue | Reports | Users |
|------|--------|-------|---------|---------|-------|
| Owner | CRUD | CRUD | CRUD | Read | CRUD |
| Manager | CRUD | CRUD | CRUD | Read | - |
| Worker | Read | Read | Read | Read | - |

## Struktura Komponentรณw Frontend

```
app.js
โ
โโโ Configuration
โ   โโโ API_URL
โ
โโโ State Management
โ   โโโ currentUser
โ   โโโ accessToken
โ   โโโ events[]
โ   โโโ costs[]
โ   โโโ revenues[]
โ
โโโ API Layer
โ   โโโ apiRequest()
โ   โโโ refreshAccessToken()
โ
โโโ Authentication
โ   โโโ login()
โ   โโโ register()
โ   โโโ logout()
โ   โโโ loadCurrentUser()
โ
โโโ Navigation
โ   โโโ navigate()
โ   โโโ showLogin()
โ   โโโ showApp()
โ
โโโ Data Modules
โ   โโโ Dashboard
โ   โ   โโโ loadDashboard()
โ   โโโ Events
โ   โ   โโโ loadEvents()
โ   โ   โโโ saveEvent()
โ   โ   โโโ deleteEvent()
โ   โโโ Costs
โ   โ   โโโ loadCosts()
โ   โ   โโโ saveCost()
โ   โ   โโโ deleteCost()
โ   โโโ Revenue
โ   โ   โโโ loadRevenue()
โ   โ   โโโ saveRevenue()
โ   โ   โโโ deleteRevenue()
โ   โโโ Reports
โ   โ   โโโ generateReport()
โ   โโโ Users
โ       โโโ loadUsers()
โ       โโโ updateUserRole()
โ
โโโ UI Helpers
    โโโ showLoading()
    โโโ showToast()
    โโโ openModal()
    โโโ closeModal()
```

## Security Measures

### Implementowane

1. **JWT Authentication**
   - Access token: 30 min expiry
   - Refresh token: 7 days expiry
   - Secure token storage (localStorage)

2. **Password Security**
   - bcrypt hashing (cost factor: 12)
   - Minimum requirements enforcement

3. **Input Validation**
   - Pydantic schemas
   - SQL injection prevention via ORM

4. **CORS Protection**
   - Whitelist configuration
   - Credentials support

5. **RBAC**
   - Endpoint-level authorization
   - UI element visibility control

### Do wdroลผenia (TODO)

- Rate limiting
- 2FA for admin
- Audit logging
- IP whitelisting

## Performance Optimizations

1. **Database**
   - Indexed columns: id, email, event_id
   - Eager loading relationships
   - Connection pooling (PostgreSQL)

2. **API**
   - Async endpoints
   - Efficient queries (aggregations)
   - Response compression

3. **Frontend**
   - Single Page Application
   - Lazy loading data
   - Efficient DOM updates
